{% extends 'admin_layout.html.twig' %}

{% block title %}Tableau de bord{% endblock %}

{% block activeDashboard %} active show {% endblock %}

{% block toolbar %}
    <a href="{{ path('admin_app_image_download') }}" class="btn btn-sm btn-primary">
        <i class="fas fa-download"></i> Télécharger les images
    </a>
    <a href="{{ path('admin_app_backup_create') }}" class="btn btn-primary btn-sm">
        <i class="fas fa-plus-circle" aria-hidden="true"></i>
        Sauvegarder les données
    </a>
{% endblock %}

{% block body %}
    <p>
        Bienvenue sur le panneau d'administration. Ici, vous allez pouvoir gérer l'encyclopédie et son contenu.
        Cette page vous offre une vue d'ensemble des statistiques du site. Sur le menu à droite, vous pouvez accéder à la gestion du contenu.
        Les deux boutons ci-dessous, <strong>Télécharger les images</strong> et <strong>Sauvegarder les données</strong> vous permettent 
        d'effectuer des sauvegardes rapides de la base de données et de télécharger les images stockées sur le serveur.
    </p>
    <div class="row">
        <div class="col-md-6">
            <div class="card border-top-grey">
                <div class="card-header bg-white">
                    <h2 class="h5 card-title mb-0">Statistiques de l'encyclopédie</h2>
                </div>
                <div class="card-body card-show">
                    <table class="table stats-table mb-0">
                        <tbody>
                            <tr>
                                <th style="width: 40%" class="text-end">Catégorie</th>
                                <td class="text-center">{{ stats.category }}</td>
                                <td>  
                                    <a href="{{ path('admin_app_category_create') }}" class="small text-decoration-none me-3">
                                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                        Ajouter
                                    </a>
                                    <a href="{{ path('admin_app_category_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">Portail</th>
                                <td class="text-center">{{ stats.portal }}</td>
                                <td>  
                                    <a href="{{ path('admin_app_portal_create') }}" class="small text-decoration-none me-3">
                                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                        Ajouter
                                    </a>
                                    <a href="{{ path('admin_app_portal_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">Article</th>
                                <td class="text-center">{{ stats.article }}</td>
                                <td>  
                                    <a href="{{ path('admin_app_article_create') }}" class="small text-decoration-none me-3">
                                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                        Ajouter
                                    </a>
                                    <a href="{{ path('admin_app_article_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">Image</th>
                                <td class="text-center">{{ stats.image }}</td>
                                <td>  
                                    <a href="{{ path('admin_app_image_create') }}" class="small text-decoration-none me-3">
                                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                        Ajouter
                                    </a>
                                    <a href="{{ path('admin_app_image_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">Personnage</th>
                                <td class="text-center">{{ stats.person }}</td>
                                <td>  
                                    <a href="{{ path('admin_app_person_create') }}" class="small text-decoration-none me-3">
                                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                        Ajouter
                                    </a>
                                    <a href="{{ path('admin_app_person_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">Lieu</th>
                                <td class="text-center">{{ stats.place }}</td>
                                <td>  
                                    <a href="{{ path('admin_app_place_create') }}" class="small text-decoration-none me-3">
                                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                        Ajouter
                                    </a>
                                    <a href="{{ path('admin_app_place_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">Page</th>
                                <td class="text-center">{{ stats.page }}</td>
                                <td>  
                                    <a href="{{ path('admin_app_page_create') }}" class="small text-decoration-none me-3">
                                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                        Ajouter
                                    </a>
                                    <a href="{{ path('admin_app_page_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card border-top-grey mt-3">
                <div class="card-header bg-white">
                    <h2 class="h5 card-title mb-0">Statistiques des utilisateurs</h2>
                </div>
                <div class="card-body card-show">
                    <table class="table stats-table mb-0">
                        <tbody>
                            <tr>
                                <th style="width: 40%" class="text-end">Utilisateurs</th>
                                <td class="text-center">{{ stats.user }}</td>
                                <td>  
                                    <a href="{{ path('admin_app_user_create') }}" class="small text-decoration-none me-3">
                                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                        Ajouter
                                    </a>
                                    <a href="{{ path('admin_app_user_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">Note</th>
                                <td class="text-center">{{ stats.note }}</td>
                                <td>  
                                    <a href="{{ path('admin_app_note_create') }}" class="small text-decoration-none me-3">
                                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                        Ajouter
                                    </a>
                                    <a href="{{ path('admin_app_note_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">Commentaire</th>
                                <td class="text-center">{{ stats.comment }}</td>
                                <td> 
                                    <a href="{{ path('admin_app_comment_list') }}" class="small text-decoration-none">
                                        <i class="fas fa-list" aria-hidden="true"></i>
                                        Liste
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-top-primary">
                <div class="card-header bg-white">
                    <h2 class="h5 card-title mb-0">
                        <i class="fas fa-sticky-note me-1"></i> Les 5 dernières notes
                    </h2>
                </div>
                <div class="card-body card-show">
                    <table class="table table-striped mb-0">
                        <thead>
                            <tr>
                                <th>Titre</th>
                                <th>Création</th>
                                <th class="table-id">Est traité</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for note in notes %}
                                <tr>
                                    <td>
                                        <a href="{{ path('admin_app_note_show', {id: note.id}) }}" class="link-primary fw-bold">
                                            {{ note.title }}
                                        </a>
                                    </td>
                                    <td>{{ note.createdAt|date('d/m/Y à H:i') }}</td>
                                    <td>
                                        {% if note.isProcessed %}
                                            <div role="button" data-id="{{ note.id }}" data-action="update-processed" class="badge rounded-pill bg-success">
                                                Traité
                                            </div>
                                        {% else %}
                                            <div role="button" data-id="{{ note.id }}" data-action="update-processed" class="badge rounded-pill bg-danger">
                                                A traiter
                                            </div>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="card-footer bg-white border-top-0">
                    <a href="{{ path('admin_app_note_list') }}" class="btn btn-primary w-100 btn-sm">
                        <i class="fas fa-list" aria-hidden="true"></i> Voir plus
                    </a>
                </div>
            </div>
            {# l'addition totale de toutes les stats (article + lieu + personnage) dans une carte bleus #}
            <div class="card card-stats mt-3">
                <div class="card-body">
                    <h3>{{ total }}</h3>
                    <p>
                        élément{{ total > 1 ? 's' : '' }}
                    </p>
                </div>
                <div class="icon">
                    <i class="fas fa-file" aria-hidden="true"></i>
                </div>
                <div class="card-footer text-center position-relative small">
                    dont
                    <strong>{{ stats.article }}</strong> article{{ stats.article > 1 ? 's' : '' }},
                    <strong>{{ stats.person }}</strong> personnage{{ stats.person > 1 ? 's' : '' }}
                    et <strong>{{ stats.place }}</strong> lieu{{ stats.place > 1 ? 'x' : '' }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('app') }}
{% endblock %}